{% extends "base.html" %}

{% block title %}Order Details #{{ order[0] }} - Admin{% endblock %}

{% block content %}
<!-- Luxurious Order Details Page -->
<div class="min-h-screen bg-gradient-to-b from-gray-50 to-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        
        <!-- Header Section -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-4">
            <div>
                <h1 class="text-4xl font-serif font-bold text-gray-900 mb-2 flex items-center">
                    <i class="fas fa-receipt mr-3 text-yellow-600"></i>
                    Order #{{ order[0] }}
                </h1>
                <p class="text-gray-600">Complete order information and customer details</p>
            </div>
            <div class="flex gap-3">
                <a href="{{ url_for('admin_orders') }}" 
                   class="inline-flex items-center bg-gray-900 hover:bg-gray-800 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 shadow-lg">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Back to Orders
                </a>
                <a href="{{ url_for('admin_download_bill', order_id=order[0]) }}" 
                   class="inline-flex items-center bg-yellow-500 hover:bg-yellow-600 text-gray-900 px-6 py-3 rounded-xl font-bold transition-all duration-300 shadow-lg">
                    <i class="fas fa-download mr-2"></i>
                    Download Bill
                </a>
            </div>
        </div>
        
        <!-- Two Column Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Order Information Card -->
            <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
                <div class="bg-gradient-to-r from-gray-900 to-gray-800 px-6 py-4">
                    <h2 class="text-xl font-bold text-white flex items-center">
                        <i class="fas fa-info-circle mr-3 text-yellow-500"></i>
                        Order Information
                    </h2>
                </div>
                <div class="p-6 space-y-6">
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <p class="text-xs uppercase tracking-wide text-gray-500 mb-2">Order ID</p>
                            <p class="text-xl font-bold text-yellow-600">#{{ order[0] }}</p>
                        </div>
                        <div>
                            <p class="text-xs uppercase tracking-wide text-gray-500 mb-2">Order Date</p>
                            <p class="text-lg font-semibold text-gray-900">{{ order[2] }}</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <p class="text-xs uppercase tracking-wide text-gray-500 mb-2">Total Amount</p>
                            <p class="text-2xl font-bold text-green-600">‚Çπ{{ "%.0f"|format(order[3]) }}</p>
                        </div>
                        <div>
                            <p class="text-xs uppercase tracking-wide text-gray-500 mb-2">Payment Method</p>
                            <div class="flex items-center text-sm font-semibold text-gray-900">
                                {% if order[4] == 'GPay' %}
                                    <i class="fab fa-google-pay text-blue-600 mr-2"></i>Google Pay
                                {% elif order[4] == 'PhonePe' %}
                                    <i class="fas fa-mobile-alt text-purple-600 mr-2"></i>PhonePe
                                {% elif order[4] == 'Paytm' %}
                                    <i class="fas fa-wallet text-blue-500 mr-2"></i>Paytm
                                {% elif order[4] == 'UPI' %}
                                    <i class="fas fa-qrcode text-green-600 mr-2"></i>UPI
                                {% elif order[4] == 'Card' %}
                                    <i class="fas fa-credit-card text-gray-700 mr-2"></i>Card
                                {% elif order[4] == 'Net Banking' %}
                                    <i class="fas fa-university text-blue-600 mr-2"></i>Net Banking
                                {% elif order[4] == 'Cash on Delivery' %}
                                    <i class="fas fa-money-bill-wave text-green-600 mr-2"></i>COD
                                {% elif order[4] == 'EMI' %}
                                    <i class="fas fa-calendar-alt text-indigo-600 mr-2"></i>EMI
                                {% else %}
                                    {{ order[4] }}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <p class="text-xs uppercase tracking-wide text-gray-500 mb-3">Order Status</p>
                        <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-bold
                            {% if order[5] == 'processing' %}bg-yellow-100 text-yellow-800
                            {% elif order[5] == 'confirmed' %}bg-blue-100 text-blue-800
                            {% elif order[5] == 'shipped' %}bg-purple-100 text-purple-800
                            {% elif order[5] == 'out_for_delivery' %}bg-indigo-100 text-indigo-800
                            {% elif order[5] == 'delivered' %}bg-green-100 text-green-800
                            {% elif order[5] == 'cancelled' %}bg-red-100 text-red-800
                            {% else %}bg-gray-100 text-gray-800{% endif %}">
                            <i class="fas fa-circle mr-2 text-xs"></i>
                            {{ order[5].replace('_', ' ').title() }}
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- Customer Information Card -->
            <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
                <div class="bg-gradient-to-r from-gray-900 to-gray-800 px-6 py-4">
                    <h2 class="text-xl font-bold text-white flex items-center">
                        <i class="fas fa-user mr-3 text-yellow-500"></i>
                        Customer Information
                    </h2>
                </div>
                <div class="p-6 space-y-5">
                    <div>
                        <p class="text-xs uppercase tracking-wide text-gray-500 mb-2">Customer Name</p>
                        <p class="text-lg font-bold text-gray-900">{{ order[8] }}</p>
                    </div>
                    
                    <div>
                        <p class="text-xs uppercase tracking-wide text-gray-500 mb-2">Email Address</p>
                        <a href="mailto:{{ order[9] }}" class="text-blue-600 hover:text-blue-700 font-medium flex items-center group">
                            <i class="fas fa-envelope mr-2"></i>
                            <span class="underline">{{ order[9] }}</span>
                        </a>
                    </div>
                    
                    <div>
                        <p class="text-xs uppercase tracking-wide text-gray-500 mb-2">Phone Number</p>
                        <a href="tel:{{ order[7] }}" class="text-green-600 hover:text-green-700 font-medium flex items-center group">
                            <i class="fas fa-phone mr-2"></i>
                            <span class="underline">{{ order[7] }}</span>
                        </a>
                    </div>
                    
                    <div>
                        <p class="text-xs uppercase tracking-wide text-gray-500 mb-2">Shipping Address</p>
                        <div class="bg-gray-50 border-2 border-gray-200 p-4 rounded-xl">
                            <p class="text-gray-900 leading-relaxed">
                                <i class="fas fa-map-marker-alt text-red-500 mr-2"></i>
                                {{ order[6] }}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Order Items Section -->
        <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden mb-8">
            <div class="bg-gradient-to-r from-gray-900 to-gray-800 px-6 py-4">
                <h2 class="text-xl font-bold text-white flex items-center">
                    <i class="fas fa-shopping-bag mr-3 text-yellow-500"></i>
                    Order Items
                </h2>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Product</th>
                            <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Category</th>
                            <th class="px-6 py-4 text-center text-xs font-bold text-gray-700 uppercase tracking-wider">Quantity</th>
                            <th class="px-6 py-4 text-right text-xs font-bold text-gray-700 uppercase tracking-wider">Unit Price</th>
                            <th class="px-6 py-4 text-right text-xs font-bold text-gray-700 uppercase tracking-wider">Total</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for item in items %}
                        <tr class="hover:bg-gray-50 transition-colors">
                            <td class="px-6 py-4">
                                <div class="flex items-center space-x-4">
                                    {% set images = item[4].split(',') if item[4] else ['tshirt.jpg'] %}
                                    <div class="flex-shrink-0 h-16 w-16 rounded-lg overflow-hidden border-2 border-gray-200">
                                        <img src="{{ url_for('static', filename='images/' + images[0].strip()) }}" 
                                             alt="{{ item[0] }}" 
                                             class="h-full w-full object-cover">
                                    </div>
                                    <div>
                                        <p class="text-sm font-bold text-gray-900">{{ item[0] }}</p>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-800">
                                    {{ item[1] }}
                                </span>
                            </td>
                            <td class="px-6 py-4 text-center">
                                <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-yellow-100 text-yellow-800 font-bold text-sm">
                                    {{ item[2] }}
                                </span>
                            </td>
                            <td class="px-6 py-4 text-right text-sm font-semibold text-gray-900">‚Çπ{{ "%.0f"|format(item[3]) }}</td>
                            <td class="px-6 py-4 text-right text-lg font-bold text-gray-900">‚Çπ{{ "%.0f"|format(item[2] * item[3]) }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot class="bg-gradient-to-r from-green-50 to-green-100 border-t-2 border-green-200">
                        <tr>
                            <th colspan="4" class="px-6 py-4 text-right text-lg font-bold text-gray-900 uppercase">Total Amount:</th>
                            <th class="px-6 py-4 text-right text-2xl font-bold text-green-600">‚Çπ{{ "%.0f"|format(order[3]) }}</th>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        
        <!-- Order Status Update Section -->
        <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
            <div class="bg-gradient-to-r from-gray-900 to-gray-800 px-6 py-4">
                <h2 class="text-xl font-bold text-white flex items-center">
                    <i class="fas fa-cog mr-3 text-yellow-500"></i>
                    Update Order Status
                </h2>
            </div>
            <div class="p-6">
                <form method="POST" action="{{ url_for('admin_update_order_status') }}">
                    <input type="hidden" name="order_id" value="{{ order[0] }}">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-end">
                        <div>
                            <label for="status" class="block text-sm font-bold text-gray-700 mb-3 uppercase tracking-wide">
                                Select New Status
                            </label>
                            <select name="status" id="status" 
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200 transition-all font-semibold text-gray-900" 
                                    required>
                                <option value="processing" {% if order[5] == 'processing' %}selected{% endif %}>‚è≥ Processing</option>
                                <option value="confirmed" {% if order[5] == 'confirmed' %}selected{% endif %}>‚úì Confirmed</option>
                                <option value="shipped" {% if order[5] == 'shipped' %}selected{% endif %}>üì¶ Shipped</option>
                                <option value="out_for_delivery" {% if order[5] == 'out_for_delivery' %}selected{% endif %}>üöö Out for Delivery</option>
                                <option value="delivered" {% if order[5] == 'delivered' %}selected{% endif %}>‚úÖ Delivered</option>
                                <option value="cancelled" {% if order[5] == 'cancelled' %}selected{% endif %}>‚ùå Cancelled</option>
                            </select>
                        </div>
                        <div>
                            <button type="submit" 
                                    class="w-full bg-gradient-to-r from-gray-900 to-gray-800 hover:from-yellow-500 hover:to-yellow-600 text-white hover:text-gray-900 px-8 py-3 rounded-xl font-bold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center justify-center">
                                <i class="fas fa-save mr-2"></i>
                                Update Status
                            </button>
                        </div>
                    </div>
                </form>
                
                <!-- Status Timeline -->
                <div class="mt-8 pt-6 border-t-2 border-gray-200">
                    <p class="text-sm font-bold text-gray-700 mb-4 uppercase tracking-wide">Order Status Timeline</p>
                    <div class="relative">
                        <!-- Timeline Line -->
                        <div class="absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200"></div>
                        
                        <!-- Timeline Items -->
                        <div class="space-y-4">
                            <div class="relative flex items-center">
                                <div class="flex-shrink-0 w-8 h-8 rounded-full {% if order[5] == 'processing' %}bg-yellow-500{% else %}bg-green-500{% endif %} flex items-center justify-center z-10">
                                    <i class="fas fa-check text-white text-xs"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-semibold text-gray-900">Order Placed</p>
                                    <p class="text-xs text-gray-500">{{ order[2] }}</p>
                                </div>
                            </div>
                            
                            {% if order[5] in ['confirmed', 'shipped', 'out_for_delivery', 'delivered'] %}
                            <div class="relative flex items-center">
                                <div class="flex-shrink-0 w-8 h-8 rounded-full bg-green-500 flex items-center justify-center z-10">
                                    <i class="fas fa-check text-white text-xs"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-semibold text-gray-900">Order Confirmed</p>
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if order[5] in ['shipped', 'out_for_delivery', 'delivered'] %}
                            <div class="relative flex items-center">
                                <div class="flex-shrink-0 w-8 h-8 rounded-full bg-green-500 flex items-center justify-center z-10">
                                    <i class="fas fa-check text-white text-xs"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-semibold text-gray-900">Order Shipped</p>
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if order[5] in ['out_for_delivery', 'delivered'] %}
                            <div class="relative flex items-center">
                                <div class="flex-shrink-0 w-8 h-8 rounded-full bg-green-500 flex items-center justify-center z-10">
                                    <i class="fas fa-check text-white text-xs"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-semibold text-gray-900">Out for Delivery</p>
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if order[5] == 'delivered' %}
                            <div class="relative flex items-center">
                                <div class="flex-shrink-0 w-8 h-8 rounded-full bg-green-500 flex items-center justify-center z-10">
                                    <i class="fas fa-check text-white text-xs"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-semibold text-gray-900">Delivered</p>
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if order[5] == 'cancelled' %}
                            <div class="relative flex items-center">
                                <div class="flex-shrink-0 w-8 h-8 rounded-full bg-red-500 flex items-center justify-center z-10">
                                    <i class="fas fa-times text-white text-xs"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-semibold text-red-600">Order Cancelled</p>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Status update form handling with confirmation
document.querySelector('form[action*="update_order_status"]').addEventListener('submit', function(e) {
    const statusSelect = document.getElementById('status');
    const currentStatus = '{{ order[5] }}';
    const newStatus = statusSelect.value;
    const newStatusText = statusSelect.options[statusSelect.selectedIndex].text;
    
    if (newStatus === currentStatus) {
        e.preventDefault();
        alert('‚ö†Ô∏è Please select a different status to update.');
        return;
    }
    
    if (!confirm(`üîÑ Are you sure you want to update the order status to "${newStatusText}"?\n\nThis action will notify the customer.`)) {
        e.preventDefault();
        statusSelect.value = currentStatus; // Reset to original
    }
});

// Add smooth scroll animation
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    });
});
</script>
{% endblock %}



